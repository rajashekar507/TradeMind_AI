<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeMind AI - Professional Trading Dashboard</title>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Socket.IO for real-time updates -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.9);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent: #06b6d4;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%);
            z-index: -1;
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(1deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }
        
        /* Header */
        .header {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
            padding: 1rem 2rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .system-status {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .status-indicator:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-1px);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        
        .status-dot.disconnected {
            background: var(--danger);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        
        /* AI Status Indicator */
        .ai-status {
            background: var(--gradient-secondary);
            color: white;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        /* Main Layout */
        .main-container {
            margin-top: 90px;
            padding: 2rem;
            max-width: 1800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        /* Enhanced Cards */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transition: all 0.4s ease;
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .card-icon {
            font-size: 1.8rem;
            opacity: 0.8;
            transition: all 0.3s ease;
        }
        
        .card:hover .card-icon {
            opacity: 1;
            transform: scale(1.1);
        }
        
        /* Enhanced Metrics */
        .metric-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 0.5rem 0;
            color: var(--success);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .metric-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            opacity: 0.9;
        }
        
        .positive { 
            color: var(--success); 
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }
        .negative { 
            color: var(--danger); 
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }
        .neutral { color: var(--text-secondary); }
        
        /* Trading Mode Toggle */
        .mode-toggle {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .mode-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .mode-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid transparent;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
        }
        
        .mode-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .mode-btn:hover::before {
            left: 100%;
        }
        
        .mode-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .mode-btn.live-mode {
            background: var(--danger);
            border-color: #dc2626;
            animation: dangerPulse 2s infinite;
        }
        
        @keyframes dangerPulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
            50% { box-shadow: 0 4px 25px rgba(239, 68, 68, 0.6); }
        }
        
        /* Enhanced Market Ticker */
        .market-ticker {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            overflow: hidden;
            position: relative;
        }
        
        .market-ticker::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--success), var(--accent), var(--warning));
            animation: tickerGlow 3s ease-in-out infinite;
        }
        
        @keyframes tickerGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .ticker-content {
            display: flex;
            gap: 3rem;
            animation: scroll-ticker 40s linear infinite;
            align-items: center;
        }
        
        @keyframes scroll-ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        
        .ticker-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            font-weight: 600;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
        }
        
        /* Chart Containers */
        .chart-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        .small-chart {
            height: 300px;
        }
        
        /* AI Signals Panel */
        .ai-signals {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.3);
        }
        
        .signal-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            background: rgba(255,255,255,0.1);
            font-weight: 600;
        }
        
        .signal-strong-buy { border-left: 4px solid var(--success); }
        .signal-buy { border-left: 4px solid #22c55e; }
        .signal-neutral { border-left: 4px solid var(--warning); }
        .signal-sell { border-left: 4px solid #f97316; }
        .signal-strong-sell { border-left: 4px solid var(--danger); }
        
        /* Enhanced Trades Table */
        .trades-table {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            color: var(--text-primary);
        }
        
        .table th {
            background: rgba(59, 130, 246, 0.1);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            position: sticky;
            top: 0;
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            vertical-align: middle;
        }
        
        .table tr:hover {
            background: rgba(255,255,255,0.05);
            transform: scale(1.01);
            transition: all 0.2s ease;
        }
        
        /* Enhanced Quick Trade Section */
        .quick-trade {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        .trade-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .form-group select,
        .form-group input {
            padding: 0.75rem;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .execute-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--secondary), var(--primary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            grid-column: 1 / -1;
            position: relative;
            overflow: hidden;
        }
        
        .execute-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .execute-btn:hover::before {
            left: 100%;
        }
        
        .execute-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }
        
        .execute-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Enhanced Notifications */
        .notification {
            position: fixed;
            top: 110px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            z-index: 2000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 400px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success), #22c55e);
            color: white;
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }
        
        .notification.warning {
            background: linear-gradient(135deg, var(--warning), #f97316);
            color: white;
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
        }
        
        /* Action Buttons */
        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 0.25rem;
        }
        
        .close-btn {
            background: var(--danger);
            color: white;
        }
        
        .close-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        /* Loading States */
        .loading {
            position: relative;
            opacity: 0.7;
            pointer-events: none;
        }
        
        .loading::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Responsive Enhancements */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                padding: 0.5rem 0;
            }
            
            .system-status {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .main-container {
                padding: 1rem;
                margin-top: 120px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .chart-wrapper {
                height: 300px;
            }
            
            .mode-toggle {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .ticker-item {
                font-size: 0.9rem;
            }
        }
        
        /* Dark mode enhancements */
        @media (prefers-color-scheme: dark) {
            :root {
                --card-bg: rgba(30, 41, 59, 0.95);
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                üß† TradeMind AI Professional
            </div>
            <div class="system-status">
                <div class="status-indicator">
                    <div class="status-dot" id="connection-status"></div>
                    <span id="system-status-text">Connecting...</span>
                </div>
                <div class="status-indicator">
                    <span id="market-status-header">Market Status</span>
                </div>
                <div class="status-indicator ai-status">
                    ü§ñ <span id="ai-status">AI Active</span>
                </div>
                <div class="status-indicator">
                    <span id="current-time">--:--:--</span>
                </div>
                <div class="status-indicator">
                    <span id="live-price">NIFTY: --</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Trading Mode Toggle -->
        <div class="mode-toggle">
            <h2>üîÄ Trading Mode Control</h2>
            <div class="mode-buttons">
                <button class="mode-btn active" id="paper-mode-btn" onclick="switchTradingMode('paper')">
                    üìù Paper Trading
                </button>
                <button class="mode-btn" id="live-mode-btn" onclick="switchTradingMode('live')">
                    üî• Live Trading
                </button>
            </div>
            <div style="font-size: 0.9rem; color: var(--text-secondary);">
                Current mode: <span id="current-mode" style="color: orange; font-weight: bold;">PAPER</span>
            </div>
        </div>

        <!-- Enhanced Market Ticker -->
        <div class="market-ticker">
            <div class="ticker-content" id="market-ticker">
                <div class="ticker-item">üìà NIFTY: <span class="positive">25,450 (+0.5%)</span></div>
                <div class="ticker-item">üìä BANKNIFTY: <span class="negative">57,200 (-0.2%)</span></div>
                <div class="ticker-item">üí∞ VIX: <span class="positive">15.8 (+2.1%)</span></div>
                <div class="ticker-item">üåç SENSEX: <span class="positive">84,250 (+0.3%)</span></div>
                <div class="ticker-item">üî• FINNIFTY: <span class="positive">24,800 (+0.7%)</span></div>
                <div class="ticker-item">‚ö° System: <span class="positive">Online</span></div>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="grid">
            <!-- Account Balance -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üí∞ Account Balance</div>
                    <div class="card-icon">üí≥</div>
                </div>
                <div class="metric-value" id="account-balance">‚Çπ0</div>
                <div class="metric-change neutral">
                    Available: <span id="available-balance">‚Çπ0</span>
                </div>
            </div>

            <!-- Today's P&L -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìà Today's P&L</div>
                    <div class="card-icon">üìä</div>
                </div>
                <div class="metric-value" id="daily-pnl">‚Çπ0</div>
                <div class="metric-change neutral" id="pnl-percentage">0.00%</div>
            </div>

            <!-- Open Positions -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üìç Open Positions</div>
                    <div class="card-icon">üìà</div>
                </div>
                <div class="metric-value" id="open-positions">0</div>
                <div class="metric-change neutral">
                    Trades Today: <span id="trades-today">0</span>
                </div>
            </div>

            <!-- Win Rate -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üéØ Win Rate</div>
                    <div class="card-icon">üèÜ</div>
                </div>
                <div class="metric-value" id="win-rate">0%</div>
                <div class="metric-change neutral">
                    <span id="win-loss">0W / 0L</span>
                </div>
            </div>

            <!-- AI Signals -->
            <div class="card ai-signals">
                <div class="card-header">
                    <div class="card-title">ü§ñ AI Trading Signals</div>
                    <div class="card-icon">üß†</div>
                </div>
                <div id="ai-signals-content">
                    <div class="signal-indicator signal-neutral">
                        <span>üîç Analyzing market conditions...</span>
                    </div>
                </div>
            </div>

            <!-- Best Trade -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">üèÜ Best Trade</div>
                    <div class="card-icon">üíé</div>
                </div>
                <div class="metric-value positive" id="best-trade">‚Çπ0</div>
                <div class="metric-change neutral">
                    Worst: <span id="worst-trade">‚Çπ0</span>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
            <!-- P&L Chart -->
            <div class="chart-container">
                <div class="chart-title">üìà Real-time P&L Performance</div>
                <div class="chart-wrapper">
                    <canvas id="pnlChart"></canvas>
                </div>
            </div>

            <!-- Win/Loss Distribution -->
            <div class="chart-container">
                <div class="chart-title">üéØ Win/Loss Distribution</div>
                <div class="chart-wrapper small-chart">
                    <canvas id="winLossChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Balance History Chart -->
        <div class="chart-container">
            <div class="chart-title">üí∞ Portfolio Balance Evolution</div>
            <div class="chart-wrapper">
                <canvas id="balanceChart"></canvas>
            </div>
        </div>

        <!-- Enhanced Trades Table -->
        <div class="trades-table">
            <h2 style="margin-bottom: 1rem;">üìã Live Trading Activity</h2>
            <div style="overflow-x: auto;">
                <table class="table">
                    <thead>
                        <tr>
                            <th>‚è∞ Time</th>
                            <th>üìä Symbol</th>
                            <th>üéØ Strike</th>
                            <th>üî¢ Type</th>
                            <th>‚ö° Action</th>
                            <th>üì¶ Lots</th>
                            <th>üí∞ Entry</th>
                            <th>üìà Current</th>
                            <th>üíµ P&L</th>
                            <th>üìç Status</th>
                            <th>üîß Action</th>
                        </tr>
                    </thead>
                    <tbody id="trades-tbody">
                        <tr>
                            <td colspan="11" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                                üîÑ Loading trades data...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Enhanced Quick Trade Section -->
        <div class="quick-trade">
            <h2 style="margin-bottom: 1rem;">‚ö° Quick Trade Execution</h2>
            <div class="trade-form">
                <div class="form-group">
                    <label>üìä Symbol</label>
                    <select id="symbol" onchange="updateStrikeSuggestions()">
                        <option value="NIFTY">NIFTY</option>
                        <option value="BANKNIFTY">BANKNIFTY</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üéØ Strike Price</label>
                    <input type="number" id="strike" placeholder="e.g. 25000" min="1" step="50">
                </div>
                
                <div class="form-group">
                    <label>üî¢ Option Type</label>
                    <select id="option-type">
                        <option value="CE">üìà Call (CE)</option>
                        <option value="PE">üìâ Put (PE)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>‚ö° Action</label>
                    <select id="action">
                        <option value="BUY">üü¢ BUY</option>
                        <option value="SELL">üî¥ SELL</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üì¶ Quantity (Lots)</label>
                    <input type="number" id="quantity" value="1" min="1" max="10">
                </div>
                
                <div class="form-group">
                    <label>üìã Order Type</label>
                    <select id="order-type" onchange="togglePriceField()">
                        <option value="MARKET">‚ö° MARKET</option>
                        <option value="LIMIT">üéØ LIMIT</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>üí∞ Price (‚Çπ)</label>
                    <input type="number" id="price" placeholder="Enter price" step="0.05" min="0.05">
                </div>
                
                <button class="execute-btn" onclick="executeTrade()" id="execute-btn">
                    üöÄ Execute Trade
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global variables and configuration
        let pnlChart, winLossChart, balanceChart;
        let socket = null;
        const API_BASE = 'http://localhost:5000/api'; // Updated to match your backend port
        let isConnected = false;
        let tradingMode = 'PAPER';
        let updateIntervals = {};
        let reconnectAttempts = 0;
        const MAX_RECONNECT_ATTEMPTS = 5;

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß† TradeMind AI Professional Dashboard Initializing...');
            
            // Initialize all components
            initializeCharts();
            connectToBackend();
            setupEventListeners();
            
            console.log('‚úÖ Dashboard initialization complete!');
        });

        // Connect to backend with WebSocket and REST API
        async function connectToBackend() {
            try {
                updateConnectionStatus('connecting');
                
                // Test REST API connection first
                const response = await fetch(`${API_BASE}/status`);
                const data = await response.json();
                
                if (data.status === 'online') {
                    isConnected = true;
                    updateConnectionStatus('connected');
                    
                    // Initialize WebSocket connection
                    initializeWebSocket();
                    
                    // Start data updates
                    startDataUpdates();
                    
                    showNotification('üü¢ Connected to TradeMind AI Backend!', 'success');
                    console.log('‚úÖ Backend connection established');
                } else {
                    throw new Error('Backend not ready');
                }
            } catch (error) {
                console.error('‚ùå Backend connection failed:', error);
                isConnected = false;
                updateConnectionStatus('disconnected');
                
                // Attempt reconnection
                if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
                    reconnectAttempts++;
                    showNotification(`‚ö†Ô∏è Connection failed, retrying... (${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})`, 'warning');
                    setTimeout(connectToBackend, 5000);
                } else {
                    showNotification('‚ùå Backend unavailable - Running in demo mode', 'error');
                    startDemoMode();
                }
            }
        }

        // Initialize WebSocket connection for real-time updates
        function initializeWebSocket() {
            try {
                socket = io('http://localhost:5000');
                
                socket.on('connect', function() {
                    console.log('üîå WebSocket connected');
                    socket.emit('subscribe_updates');
                });
                
                socket.on('real_time_update', function(data) {
                    updateDashboardData(data);
                });
                
                socket.on('ai_update', function(data) {
                    updateAISignals(data);
                });
                
                socket.on('disconnect', function() {
                    console.log('üîå WebSocket disconnected');
                    updateConnectionStatus('disconnected');
                });
                
                socket.on('connect_error', function(error) {
                    console.error('üîå WebSocket error:', error);
                });
                
            } catch (error) {
                console.error('‚ùå WebSocket initialization failed:', error);
            }
        }

        // Update connection status indicator
        function updateConnectionStatus(status) {
            const statusDot = document.getElementById('connection-status');
            const statusText = document.getElementById('system-status-text');
            
            switch (status) {
                case 'connected':
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'System Online';
                    break;
                case 'connecting':
                    statusDot.className = 'status-dot';
                    statusText.textContent = 'Connecting...';
                    break;
                case 'disconnected':
                    statusDot.className = 'status-dot disconnected';
                    statusText.textContent = 'Disconnected';
                    break;
            }
        }

        // Start regular data updates
        function startDataUpdates() {
            if (!isConnected) return;
            
            // Initial data load
            Promise.all([
                updateAccountBalance(),
                updateTradingStatistics(),
                updateMarketData(),
                updateRecentTrades(),
                updateAIAnalysis()
            ]).then(() => {
                console.log('üìä Initial data load complete');
            });
            
            // Set up update intervals
            updateIntervals.balance = setInterval(updateAccountBalance, 15000); // 15 seconds
            updateIntervals.market = setInterval(updateMarketData, 5000); // 5 seconds
            updateIntervals.trades = setInterval(updateRecentTrades, 10000); // 10 seconds
            updateIntervals.stats = setInterval(updateTradingStatistics, 20000); // 20 seconds
            updateIntervals.ai = setInterval(updateAIAnalysis, 30000); // 30 seconds
            
            console.log('‚ö° Real-time updates activated');
        }

        // Update account balance
        async function updateAccountBalance() {
            if (!isConnected) return;
            
            try {
                const response = await fetch(`${API_BASE}/balance`);
                const result = await response.json();
                
                if (result.success) {
                    updateElement('account-balance', result.balance_formatted);
                    updateElement('available-balance', result.balance_formatted);
                    
                    // Update daily P&L if available
                    if (result.daily_pnl !== undefined) {
                        const pnlElement = document.getElementById('daily-pnl');
                        const pnlPercentElement = document.getElementById('pnl-percentage');
                        
                        pnlElement.textContent = result.daily_pnl_formatted || '‚Çπ0.00';
                        pnlElement.className = `metric-value ${result.daily_pnl > 0 ? 'positive' : result.daily_pnl < 0 ? 'negative' : 'neutral'}`;
                        
                        if (pnlPercentElement) {
                            pnlPercentElement.textContent = `${result.daily_percentage?.toFixed(2) || '0.00'}%`;
                            pnlPercentElement.className = `metric-change ${result.daily_pnl > 0 ? 'positive' : result.daily_pnl < 0 ? 'negative' : 'neutral'}`;
                        }
                    }
                }
            } catch (error) {
                console.error('‚ùå Balance update failed:', error);
            }
        }

        // Update trading statistics
        async function updateTradingStatistics() {
            if (!isConnected) return;
            
            try {
                const response = await fetch(`${API_BASE}/dashboard/summary`);
                const result = await response.json();
                
                if (result) {
                    const positions = result.positions || {};
                    const performance = result.performance || {};
                    
                    updateElement('open-positions', positions.count || 0);
                    updateElement('trades-today', positions.active || 0);
                    
                    const winRate = performance.win_rate || 0;
                    const winningTrades = performance.winning_trades || 0;
                    const losingTrades = performance.losing_trades || 0;
                    
                    updateElement('win-rate', `${winRate.toFixed(1)}%`);
                    updateElement('win-loss', `${winningTrades}W / ${losingTrades}L`);
                    updateElement('best-trade', `‚Çπ${(performance.best_trade || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}`);
                    updateElement('worst-trade', `‚Çπ${(performance.worst_trade || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}`);
                }
            } catch (error) {
                console.error('‚ùå Statistics update failed:', error);
            }
        }

        // Update market data
        async function updateMarketData() {
            if (!isConnected) return;
            
            try {
                // Update NIFTY data
                const niftyResponse = await fetch(`${API_BASE}/market/nifty`);
                const niftyData = await niftyResponse.json();
                
                if (niftyData && !niftyData.error) {
                    const livePriceElement = document.getElementById('live-price');
                    if (livePriceElement) {
                        livePriceElement.textContent = `NIFTY: ${niftyData.price?.toLocaleString('en-IN') || '--'}`;
                    }
                }
                
                // Update market status
                const marketStatusElement = document.getElementById('market-status-header');
                if (marketStatusElement) {
                    const now = new Date();
                    const hour = now.getHours();
                    const isMarketOpen = hour >= 9 && hour < 16; // Simplified market hours
                    marketStatusElement.textContent = isMarketOpen ? 'üü¢ Market Open' : 'üî¥ Market Closed';
                }
                
            } catch (error) {
                console.error('‚ùå Market data update failed:', error);
            }
        }

        // Update recent trades
        async function updateRecentTrades() {
            if (!isConnected) return;
            
            try {
                const response = await fetch(`${API_BASE}/positions`);
                const result = await response.json();
                
                const trades = [...(result.live_positions || []), ...(result.portfolio_positions || [])];
                updateTradesTable(trades);
                
            } catch (error) {
                console.error('‚ùå Trades update failed:', error);
            }
        }

        // Update AI analysis
        async function updateAIAnalysis() {
            if (!isConnected) return;
            
            try {
                const response = await fetch(`${API_BASE}/ai/decision`);
                const result = await response.json();
                
                if (result && !result.error) {
                    updateAISignals(result);
                }
            } catch (error) {
                console.error('‚ùå AI analysis update failed:', error);
            }
        }

        // Update AI signals display
        function updateAISignals(data) {
            const signalsContainer = document.getElementById('ai-signals-content');
            if (!signalsContainer || !data) return;
            
            const recommendation = data.recommendation || data.combined_recommendation || 'ANALYZING';
            const confidence = data.combined_confidence || data.ml_confidence || 50;
            
            let signalClass = 'signal-neutral';
            let signalIcon = 'üîç';
            let signalText = recommendation;
            
            switch (recommendation.toUpperCase()) {
                case 'STRONG BUY':
                    signalClass = 'signal-strong-buy';
                    signalIcon = 'üöÄ';
                    break;
                case 'BUY':
                    signalClass = 'signal-buy';
                    signalIcon = 'üìà';
                    break;
                case 'SELL':
                    signalClass = 'signal-sell';
                    signalIcon = 'üìâ';
                    break;
                case 'STRONG SELL':
                    signalClass = 'signal-strong-sell';
                    signalIcon = '‚ö°';
                    break;
                default:
                    signalText = 'NEUTRAL';
            }
            
            signalsContainer.innerHTML = `
                <div class="signal-indicator ${signalClass}">
                    <span>${signalIcon} ${signalText}</span>
                    <span style="margin-left: auto; font-size: 0.8rem;">
                        ${confidence.toFixed(0)}% confidence
                    </span>
                </div>
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                    Last updated: ${new Date().toLocaleTimeString()}
                </div>
            `;
        }

        // Update trades table
        function updateTradesTable(trades) {
            const tbody = document.getElementById('trades-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (!trades || trades.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                            üìã No active trades found
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Show recent trades (last 10)
            trades.slice(-10).reverse().forEach(trade => {
                const row = document.createElement('tr');
                const time = new Date(trade.timestamp || Date.now()).toLocaleTimeString('en-IN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                const pnl = trade.pnl || 0;
                const pnlClass = pnl > 0 ? 'positive' : pnl < 0 ? 'negative' : 'neutral';
                const status = trade.status || 'UNKNOWN';
                
                let actionButton = '';
                if (status === 'OPEN') {
                    actionButton = `<button class="action-btn close-btn" onclick="closeTrade('${trade.trade_id || trade.id}')">üîí Close</button>`;
                } else {
                    actionButton = `<span style="color: var(--text-secondary);">-</span>`;
                }
                
                row.innerHTML = `
                    <td>${time}</td>
                    <td><strong>${trade.symbol || 'N/A'}</strong></td>
                    <td>${trade.strike || 'N/A'}</td>
                    <td>${trade.option_type || 'N/A'}</td>
                    <td><span style="color: ${trade.action === 'BUY' ? 'var(--success)' : 'var(--danger)'}">${trade.action || 'N/A'}</span></td>
                    <td>${trade.quantity || 0}</td>
                    <td>‚Çπ${(trade.entry_price || 0).toFixed(2)}</td>
                    <td>‚Çπ${(trade.current_price || trade.entry_price || 0).toFixed(2)}</td>
                    <td class="${pnlClass}"><strong>‚Çπ${pnl.toLocaleString('en-IN', {minimumFractionDigits: 2})}</strong></td>
                    <td><span style="color: ${status === 'OPEN' ? '#f59e0b' : '#10b981'}">${status}</span></td>
                    <td>${actionButton}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Execute trade function
        async function executeTrade() {
            if (!isConnected) {
                showNotification('‚ùå Backend not connected - cannot execute trade', 'error');
                return;
            }
            
            // Get form values
            const symbol = document.getElementById('symbol').value;
            const strike = parseFloat(document.getElementById('strike').value);
            const optionType = document.getElementById('option-type').value;
            const action = document.getElementById('action').value;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const orderType = document.getElementById('order-type').value;
            const price = parseFloat(document.getElementById('price').value);
            
            // Validate inputs
            if (!strike || strike <= 0) {
                showNotification('‚ö†Ô∏è Please enter a valid strike price', 'warning');
                return;
            }
            
            if (orderType === 'LIMIT' && (!price || price <= 0)) {
                showNotification('‚ö†Ô∏è Please enter a valid price for limit order', 'warning');
                return;
            }
            
            const tradeData = {
                symbol,
                strike,
                option_type: optionType,
                action,
                quantity,
                order_type: orderType,
                price: orderType === 'MARKET' ? 0 : price
            };
            
            try {
                // Show loading state
                const executeBtn = document.getElementById('execute-btn');
                const originalText = executeBtn.textContent;
                executeBtn.textContent = '‚è≥ Executing...';
                executeBtn.disabled = true;
                
                const response = await fetch(`${API_BASE}/trading/execute`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(tradeData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ Trade executed successfully! Order ID: ${result.trade_id}`, 'success');
                    
                    // Clear form
                    document.getElementById('strike').value = '';
                    document.getElementById('price').value = '';
                    
                    // Refresh data
                    setTimeout(() => {
                        updateAccountBalance();
                        updateTradingStatistics();
                        updateRecentTrades();
                    }, 1000);
                    
                } else {
                    showNotification(`‚ùå Trade failed: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Trade execution error:', error);
                showNotification('‚ùå Trade execution failed - please try again', 'error');
            } finally {
                // Reset button
                const executeBtn = document.getElementById('execute-btn');
                executeBtn.textContent = originalText;
                executeBtn.disabled = false;
            }
        }

        // Close trade function
        async function closeTrade(tradeId) {
            if (!isConnected) {
                showNotification('‚ùå Backend not connected', 'error');
                return;
            }
            
            if (!confirm('Are you sure you want to close this trade?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/trading/close`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ trade_id: tradeId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('‚úÖ Trade closed successfully!', 'success');
                    
                    // Refresh data
                    setTimeout(() => {
                        updateAccountBalance();
                        updateTradingStatistics();
                        updateRecentTrades();
                    }, 1000);
                } else {
                    showNotification(`‚ùå Failed to close trade: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Close trade error:', error);
                showNotification('‚ùå Failed to close trade', 'error');
            }
        }

        // Switch trading mode
        async function switchTradingMode(mode) {
            if (mode === 'live') {
                const confirmed = confirm(
                    '‚ö†Ô∏è WARNING: You are switching to LIVE TRADING mode!\n\n' +
                    'This will execute real trades with real money.\n' +
                    'Are you absolutely sure you want to continue?'
                );
                
                if (!confirmed) return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/trading/mode`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        mode: mode.toLowerCase(),
                        confirmation: mode === 'live' ? true : false
                    })
                });
                
                const result = await response.json();
                
                if (result.mode) {
                    tradingMode = result.mode.toUpperCase();
                    updateTradingModeUI(tradingMode);
                    showNotification(`‚úÖ Switched to ${tradingMode} trading mode`, 'success');
                } else {
                    showNotification('‚ùå Failed to switch trading mode', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Mode switch error:', error);
                showNotification('‚ùå Failed to switch trading mode', 'error');
            }
        }

        // Update trading mode UI
        function updateTradingModeUI(mode) {
            const paperBtn = document.getElementById('paper-mode-btn');
            const liveBtn = document.getElementById('live-mode-btn');
            const currentModeSpan = document.getElementById('current-mode');
            
            if (mode === 'LIVE') {
                paperBtn.classList.remove('active');
                liveBtn.classList.add('active', 'live-mode');
                currentModeSpan.textContent = 'LIVE';
                currentModeSpan.style.color = 'var(--danger)';
            } else {
                liveBtn.classList.remove('active', 'live-mode');
                paperBtn.classList.add('active');
                currentModeSpan.textContent = 'PAPER';
                currentModeSpan.style.color = 'orange';
            }
        }

        // Toggle price field based on order type
        function togglePriceField() {
            const orderType = document.getElementById('order-type').value;
            const priceField = document.getElementById('price');
            
            if (orderType === 'MARKET') {
                priceField.disabled = true;
                priceField.placeholder = 'Market price';
                priceField.required = false;
            } else {
                priceField.disabled = false;
                priceField.placeholder = 'Enter limit price';
                priceField.required = true;
            }
        }

        // Update strike suggestions based on symbol
        function updateStrikeSuggestions() {
            const symbol = document.getElementById('symbol').value;
            const strikeField = document.getElementById('strike');
            
            if (symbol === 'NIFTY') {
                strikeField.placeholder = 'e.g. 25000';
                strikeField.step = '50';
            } else if (symbol === 'BANKNIFTY') {
                strikeField.placeholder = 'e.g. 55000';
                strikeField.step = '100';
            }
        }

        // Initialize all charts
        function initializeCharts() {
            initializePnLChart();
            initializeWinLossChart();
            initializeBalanceChart();
        }

        // Initialize P&L Chart
        function initializePnLChart() {
            const ctx = document.getElementById('pnlChart').getContext('2d');
            
            pnlChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['9:15', '9:30', '9:45', '10:00', '10:15', '10:30', '10:45', '11:00', '11:15', '11:30'],
                    datasets: [{
                        label: 'P&L (‚Çπ)',
                        data: [0, 180, -65, 250, 420, 180, 540, 320, 480, 650],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#f8fafc',
                                font: { size: 14, weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#f8fafc',
                            borderColor: '#3b82f6',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: { 
                                color: '#cbd5e1',
                                font: { size: 12 }
                            }
                        },
                        y: {
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#cbd5e1',
                                font: { size: 12 },
                                callback: function(value) {
                                    return '‚Çπ' + value.toLocaleString();
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Initialize Win/Loss Chart
        function initializeWinLossChart() {
            const ctx = document.getElementById('winLossChart').getContext('2d');
            
            winLossChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Winning Trades', 'Losing Trades', 'Breakeven'],
                    datasets: [{
                        data: [68, 22, 10],
                        backgroundColor: ['#10b981', '#ef4444', '#f59e0b'],
                        borderColor: ['#ffffff', '#ffffff', '#ffffff'],
                        borderWidth: 3,
                        hoverBorderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#f8fafc',
                                padding: 20,
                                font: { size: 12, weight: '500' },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#f8fafc',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize Balance Chart
        function initializeBalanceChart() {
            const ctx = document.getElementById('balanceChart').getContext('2d');
            
            balanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Today'],
                    datasets: [{
                        label: 'Balance (‚Çπ)',
                        data: [100000, 101500, 99500, 103000, 104500, 102000, 106500, 108200],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#f8fafc',
                                font: { size: 14, weight: '600' }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(30, 41, 59, 0.9)',
                            titleColor: '#f8fafc',
                            bodyColor: '#f8fafc',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return 'Balance: ‚Çπ' + context.parsed.y.toLocaleString('en-IN');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: { 
                                color: '#cbd5e1',
                                font: { size: 12 }
                            }
                        },
                        y: {
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                drawBorder: false
                            },
                            ticks: {
                                color: '#cbd5e1',
                                font: { size: 12 },
                                callback: function(value) {
                                    return '‚Çπ' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update dashboard with real-time data
        function updateDashboardData(data) {
            if (data.balance !== undefined) {
                updateElement('account-balance', data.balance_formatted || `‚Çπ${data.balance.toLocaleString('en-IN', {minimumFractionDigits: 2})}`);
            }
            
            if (data.daily_pnl !== undefined) {
                const pnlElement = document.getElementById('daily-pnl');
                if (pnlElement) {
                    pnlElement.textContent = data.daily_pnl_formatted || `‚Çπ${data.daily_pnl.toLocaleString('en-IN', {minimumFractionDigits: 2})}`;
                    pnlElement.className = `metric-value ${data.daily_pnl > 0 ? 'positive' : data.daily_pnl < 0 ? 'negative' : 'neutral'}`;
                }
            }
            
            if (data.positions_count !== undefined) {
                updateElement('open-positions', data.positions_count);
            }
            
            // Update market status
            if (data.market_status) {
                const marketStatusElement = document.getElementById('market-status-header');
                if (marketStatusElement) {
                    marketStatusElement.textContent = data.market_status === 'OPEN' ? 'üü¢ Market Open' : 'üî¥ Market Closed';
                }
            }
        }

        // Start demo mode when backend is unavailable
        function startDemoMode() {
            console.log('üé≠ Starting demo mode...');
            
            // Set demo data
            updateElement('account-balance', '‚Çπ1,00,000.00');
            updateElement('available-balance', '‚Çπ95,000.00');
            updateElement('daily-pnl', '‚Çπ+2,500.00');
            document.getElementById('daily-pnl').className = 'metric-value positive';
            updateElement('pnl-percentage', '+2.5%');
            document.getElementById('pnl-percentage').className = 'metric-change positive';
            updateElement('open-positions', '3');
            updateElement('trades-today', '5');
            updateElement('win-rate', '72.5%');
            updateElement('win-loss', '8W / 3L');
            updateElement('best-trade', '‚Çπ1,850.00');
            updateElement('worst-trade', '‚Çπ-650.00');
            
            // Demo AI signals
            updateAISignals({
                recommendation: 'BUY',
                combined_confidence: 78,
                timestamp: new Date().toISOString()
            });
            
            // Demo trades
            const demoTrades = [
                {
                    trade_id: 'DEMO_001',
                    timestamp: new Date(Date.now() - 300000).toISOString(),
                    symbol: 'NIFTY',
                    strike: 25300,
                    option_type: 'CE',
                    action: 'BUY',
                    quantity: 2,
                    entry_price: 145.50,
                    current_price: 162.75,
                    pnl: 2587.50,
                    status: 'OPEN'
                },
                {
                    trade_id: 'DEMO_002',
                    timestamp: new Date(Date.now() - 600000).toISOString(),
                    symbol: 'BANKNIFTY',
                    strike: 55500,
                    option_type: 'PE',
                    action: 'BUY',
                    quantity: 1,
                    entry_price: 238.25,
                    current_price: 195.80,
                    pnl: -1273.50,
                    status: 'OPEN'
                }
            ];
            
            updateTradesTable(demoTrades);
            
            showNotification('üé≠ Running in demo mode - Backend unavailable', 'warning');
        }

        // Setup event listeners
        function setupEventListeners() {
            // Handle form submissions with Enter key
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.closest('.quick-trade')) {
                    e.preventDefault();
                    executeTrade();
                }
            });
            
            // Handle window resize for charts
            window.addEventListener('resize', function() {
                if (pnlChart) pnlChart.resize();
                if (winLossChart) winLossChart.resize();
                if (balanceChart) balanceChart.resize();
            });
            
            // Handle visibility change to pause/resume updates
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    // Pause updates when tab is hidden
                    Object.values(updateIntervals).forEach(clearInterval);
                } else {
                    // Resume updates when tab becomes visible
                    if (isConnected) {
                        startDataUpdates();
                    }
                }
            });
            
            // Initialize form dependencies
            togglePriceField();
            updateStrikeSuggestions();
        }

        // Update current time
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-IN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            updateElement('current-time', timeString);
        }

        // Utility function to update element content
        function updateElement(elementId, value) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = value;
            }
        }

        // Enhanced notification system
        function showNotification(message, type = 'info', duration = 5000) {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notif => {
                notif.classList.remove('show');
                setTimeout(() => notif.remove(), 300);
            });
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${getNotificationIcon(type)}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Animate out
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 400);
            }, duration);
        }

        // Get notification icon based on type
        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return '‚úÖ';
                case 'error': return '‚ùå';
                case 'warning': return '‚ö†Ô∏è';
                case 'info': return '‚ÑπÔ∏è';
                default: return 'üì¢';
            }
        }

        // Start time updates
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();

        // Performance monitoring
        let performanceMetrics = {
            pageLoadTime: performance.now(),
            apiCalls: 0,
            successfulApiCalls: 0,
            failedApiCalls: 0
        };

        // Log performance metrics
        function logPerformanceMetrics() {
            console.log('üìä TradeMind AI Dashboard Performance Metrics:');
            console.log(`   Page Load Time: ${performanceMetrics.pageLoadTime.toFixed(2)}ms`);
            console.log(`   API Calls: ${performanceMetrics.apiCalls}`);
            console.log(`   Success Rate: ${((performanceMetrics.successfulApiCalls / performanceMetrics.apiCalls) * 100).toFixed(1)}%`);
            console.log(`   Connection Status: ${isConnected ? 'Connected' : 'Disconnected'}`);
            console.log(`   Trading Mode: ${tradingMode}`);
        }

        // Log performance metrics every 5 minutes
        setInterval(logPerformanceMetrics, 300000);

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('üö® Global error:', e.error);
            showNotification('‚ö†Ô∏è An unexpected error occurred', 'error');
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(e) {
            console.error('üö® Unhandled promise rejection:', e.reason);
            showNotification('‚ö†Ô∏è A network error occurred', 'warning');
        });

        // Initialize dashboard
        console.log('üß† TradeMind AI Professional Dashboard loaded successfully!');
        console.log('üöÄ Available Features:');
        console.log('   ‚úÖ Real-time trading execution');
        console.log('   ‚úÖ Live P&L tracking with charts');
        console.log('   ‚úÖ WebSocket real-time updates');
        console.log('   ‚úÖ AI trading signals');
        console.log('   ‚úÖ Advanced position management');
        console.log('   ‚úÖ Paper/Live trading modes');
        console.log('   ‚úÖ Professional notifications');
        console.log('   ‚úÖ Responsive design');
        console.log('   ‚úÖ Error recovery & demo mode');
        console.log('üéØ Ready for professional trading!');
    </script>
</body>
</html>